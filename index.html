
<html><head><base href="https://example.com"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>YupLand NFT Power Dashboard</title><style>
    :root {
        --primary-color: #4a5568;
        --secondary-color: #718096;
        --background-color: #1a202c;
        --text-color: #e2e8f0;
        --card-background: #2d3748;
        --border-radius: 6px;
        --highlight-color: #6b46c1;
    }

    body {
        font-family: 'Inter', sans-serif;
        line-height: 1.4;
        color: var(--text-color);
        background-color: var(--background-color);
        margin: 0;
        padding: 10px;
        font-size: 14px;
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
    }

    h1 {
        color: var(--primary-color);
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
        font-weight: 600;
    }

    .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
    }

    .dashboard-item {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .dashboard-item h3 {
        font-size: 12px;
        margin-bottom: 5px;
        color: var(--primary-color);
        font-weight: 500;
    }

    .dashboard-item p {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
        color: var(--highlight-color);
    }

    .nft-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
    }

    .nft-type {
        background-color: var(--card-background);
        border-radius: var(--border-radius);
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .nft-type h3 {
        font-size: 14px;
        margin-bottom: 10px;
        color: var(--primary-color);
        font-weight: 500;
        text-align: center;
    }

    .nft-type-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        gap: 5px;
    }

    .nft-type-item {
        background-color: #3a4a5e;
        border-radius: var(--border-radius);
        padding: 5px;
        font-size: 12px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 50px;
    }

    .nft-type-item span:first-child {
        font-weight: bold;
        margin-bottom: 2px;
        color: var(--highlight-color);
    }

    .filter-section {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }

    .filter-input {
        flex: 1;
        min-width: 120px;
        padding: 8px;
        border: 1px solid #4a5568;
        border-radius: var(--border-radius);
        font-size: 14px;
        background-color: #2d3748;
        color: var(--text-color);
    }

    .calculate-btn {
        background-color: var(--highlight-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: var(--border-radius);
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    .calculate-btn:hover {
        background-color: #553c9a;
    }

    .address-list {
        display: table;
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 5px;
    }

    .address-item {
        display: table-row;
        background-color: var(--card-background);
        transition: transform 0.3s ease;
    }

    .address-item > div {
        display: table-cell;
        padding: 8px;
        vertical-align: middle;
        font-size: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .address-item:hover {
        transform: translateY(-2px);
    }

    .address-item.first > div {
        background-color: rgba(255, 215, 0, 0.1);
    }

    .address-item.second > div {
        background-color: rgba(192, 192, 192, 0.1);
    }

    .address-item.third > div {
        background-color: rgba(205, 127, 50, 0.1);
    }

    .address {
        font-weight: 500;
        max-width: 150px;
    }

    .total-power, .reward {
        font-weight: 600;
        color: var(--highlight-color);
        text-align: right;
    }

    #loading {
        text-align: center;
        font-size: 16px;
        margin-top: 20px;
        color: var(--primary-color);
    }

    #error {
        color: #e74c3c;
        text-align: center;
        font-weight: bold;
        background-color: #2d3748;
        padding: 10px;
        border-radius: var(--border-radius);
        margin-top: 20px;
    }

    @media (max-width: 600px) {
        body {
            font-size: 12px;
        }

        .dashboard, .nft-types {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        }

        .filter-input, .calculate-btn {
            width: 100%;
        }

        .address-item > div {
            font-size: 10px;
            padding: 6px;
        }

        .address {
            max-width: 100px;
        }
    }
</style></head><body>
    <div class="container">
        <h1>YupLand NFT Power Dashboard</h1>
        
        <div class="dashboard">
            <div class="dashboard-item">
                <h3>Total Holders</h3>
                <p id="total-holders">0</p>
            </div>
            <div class="dashboard-item">
                <h3>Total NFTs</h3>
                <p id="total-nfts">0</p>
            </div>
            <div class="dashboard-item">
                <h3>Total Power</h3>
                <p id="total-power">0%</p>
            </div>
        </div>

        <div class="nft-types">
            <div class="nft-type">
                <h3>Partner NFTs</h3>
                <div class="nft-type-items">
                    <div class="nft-type-item" id="nft-0"><span>0</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-1"><span>1</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-2"><span>2</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-3"><span>3</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-4"><span>4</span><span>0</span></div>
                </div>
            </div>
            <div class="nft-type">
                <h3>Community NFTs</h3>
                <div class="nft-type-items">
                    <div class="nft-type-item" id="nft-legendary"><span>Leg</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-epic"><span>Epic</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-rare"><span>Rare</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-uncommon"><span>Unc</span><span>0</span></div>
                    <div class="nft-type-item" id="nft-common"><span>Com</span><span>0</span></div>
                </div>
            </div>
        </div>

        <div class="filter-section">
            <input type="text" id="address-filter" class="filter-input" placeholder="Filter by address">
            <input type="number" id="allocation-input" class="filter-input" placeholder="Allocation (million)" value="100">
            <button id="calculate-btn" class="calculate-btn">Calculate</button>
        </div>

        <div id="loading">Loading data...</div>
        <div id="error" style="display: none;"></div>
        <div id="nft-data" class="address-list"></div>
    </div>

    <script>
        let allNFTs = [];
        let totalPower = 0;
        let rewardPerPercent = 0;
        let totalHolders = 0;
        let totalNFTs = 0;

        async function fetchNFTs() {
            let page = 1;
            const perPage = 25;
            let hasMore = true;
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');
            
            const excludedOwners = [
                '0000000000000000000000000000000000000000000000000000000000000000',
                'darai_nft.near',
                'darai_collection.near'
            ];

            const excludedTitles = ['egg', 'passport', 'Yupik - Chiter', 'Chest', 'Press', 'тест', 'boost', 'mystical'];

            const powerLevels = {
                '0': 100,
                '1': 50,
                '2': 25,
                '3': 12.5,
                '4': 6.25,
                'legendary': 3.125,
                'epic': 1.5625,
                'rare': 0.78125,
                'uncommon': 0.390625,
                'common': 0.1953125
            };

            while (hasMore) {
                try {
                    const response = await fetch(`https://api.nearblocks.io/v1/nfts/darai.mintbase1.near/tokens?page=${page}&per_page=${perPage}`);
                    const data = await response.json();

                    if (data && data.tokens && data.tokens.length > 0) {
                        const filteredData = data.tokens
                            .filter(token => {
                                if (!token.title) return false;
                                const lowerTitle = token.title.toLowerCase();
                                return !excludedTitles.some(excluded => lowerTitle.includes(excluded.toLowerCase())) &&
                                       !excludedOwners.includes(token.asset.owner);
                            })
                            .map(token => {
                                const titleLower = token.title.toLowerCase();
                                let power = 0;
                                for (const [key, value] of Object.entries(powerLevels)) {
                                    if (titleLower.includes(key)) {
                                        power = value;
                                        break;
                                    }
                                }
                                return {
                                    title: token.title,
                                    id: token.token || '-',
                                    owner: token.asset.owner,
                                    power: power
                                };
                            });

                        allNFTs = allNFTs.concat(filteredData);
                        page++;
                        updateDashboard();
                        updateNFTDisplay();
                    } else {
                        hasMore = false;
                    }
                } catch (error) {
                    errorElement.textContent = "Error fetching data. Please try again later.";
                    errorElement.style.display = 'block';
                    loadingElement.style.display = 'none';
                    console.error("Error fetching data:", error);
                    hasMore = false;
                }
            }

            loadingElement.style.display = 'none';
        }

        function updateDashboard() {
            const addressMap = new Map();
            totalPower = 0;

            allNFTs.forEach(nft => {
                if (!addressMap.has(nft.owner)) {
                    addressMap.set(nft.owner, { totalPower: 0, nfts: [] });
                }
                const addressData = addressMap.get(nft.owner);
                addressData.totalPower += nft.power;
                addressData.nfts.push(nft);
                totalPower += nft.power;
            });

            totalHolders = addressMap.size;
            totalNFTs = allNFTs.length;

            document.getElementById('total-holders').textContent = totalHolders;
            document.getElementById('total-nfts').textContent = totalNFTs;
            document.getElementById('total-power').textContent = totalPower.toFixed(4) + '%';

            const nftCounts = {
                '0': 0, '1': 0, '2': 0, '3': 0, '4': 0,
                'legendary': 0, 'epic': 0, 'rare': 0, 'uncommon': 0, 'common': 0
            };

            allNFTs.forEach(nft => {
                const titleLower = nft.title.toLowerCase();
                for (const key of Object.keys(nftCounts)) {
                    if (titleLower.includes(key)) {
                        nftCounts[key]++;
                        break;
                    }
                }
            });

            for (const [key, value] of Object.entries(nftCounts)) {
                const element = document.getElementById(`nft-${key}`);
                if (element) {
                    element.querySelector('span:last-child').textContent = value;
                }
            }
        }

        function updateNFTDisplay(filter = '') {
            const nftDataElement = document.getElementById('nft-data');
            const addressMap = new Map();

            allNFTs.forEach(nft => {
                if (!filter || nft.owner.toLowerCase().includes(filter.toLowerCase())) {
                    if (!addressMap.has(nft.owner)) {
                        addressMap.set(nft.owner, { totalPower: 0, nfts: [] });
                    }
                    const addressData = addressMap.get(nft.owner);
                    addressData.totalPower += nft.power;
                    addressData.nfts.push(nft);
                }
            });

            const filteredAddresses = Array.from(addressMap.entries())
                .sort((a, b) => {
                    if (b[1].totalPower !== a[1].totalPower) {
                        return b[1].totalPower - a[1].totalPower;
                    }
                    return a[0].localeCompare(b[0]);
                });

            nftDataElement.innerHTML = filteredAddresses.map(([address, data], index) => `
                <div class="address-item ${index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : ''}">
                    <div class="address">${index + 1}. ${address}</div>
                    <div class="total-power">${data.totalPower.toFixed(4)}%</div>
                    <div class="reward">${(data.totalPower * rewardPerPercent).toFixed(2)}</div>
                </div>
            `).join('');

            updateNFTCounts(filter);
        }

        function updateNFTCounts(filter = '') {
            const nftCounts = {
                '0': 0, '1': 0, '2': 0, '3': 0, '4': 0,
                'legendary': 0, 'epic': 0, 'rare': 0, 'uncommon': 0, 'common': 0
            };

            allNFTs.forEach(nft => {
                if (!filter || nft.owner.toLowerCase().includes(filter.toLowerCase())) {
                    const titleLower = nft.title.toLowerCase();
                    for (const key of Object.keys(nftCounts)) {
                        if (titleLower.includes(key)) {
                            nftCounts[key]++;
                            break;
                        }
                    }
                }
            });

            for (const [key, value] of Object.entries(nftCounts)) {
                const element = document.getElementById(`nft-${key}`);
                if (element) {
                    element.querySelector('span:last-child').textContent = value;
                }
            }
        }

        document.getElementById('address-filter').addEventListener('input', function(e) {
            updateNFTDisplay(e.target.value);
        });

        document.getElementById('calculate-btn').addEventListener('click', function() {
            const allocation = parseFloat(document.getElementById('allocation-input').value) * 1000000;
            if (isNaN(allocation)) {
                alert('Please enter a valid allocation amount');
                return;
            }
            rewardPerPercent = allocation / totalPower;
            updateNFTDisplay(document.getElementById('address-filter').value);

            // Close the keyboard on mobile devices
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                document.activeElement.blur();
            }
        });

        fetchNFTs();
    </script>
</body></html>
